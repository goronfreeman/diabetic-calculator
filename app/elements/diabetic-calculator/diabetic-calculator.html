<link rel="import" href="../elements.html">

<polymer-element name="diabetic-calculator" attributes="">
  <template>
    <link rel="stylesheet" href="diabetic-calculator.css">

    <core-animated-pages selected="{{step}}" transitions="slide-from-bottom">
      <section class="card center-content" id="percentage">
        <div>
          <paper-input id="population" floatingLabel="true" label="Surrounding Population"></paper-input>
        </div>
        <core-label>
          How much diabeetus do you want?
          <div>
            <paper-slider id="slider" min="0" max="20" value="7" pin="true"></paper-slider>
          </div>
        </core-label>
        <paper-button id="selectPercentage" raised="true" role="button">Confirm</paper-button>
      </section>
      <section class="card" id="stats">
        <table class="table table-striped">
          <thead>
            <tr>
              <th colspan="2">Stats</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Diabetic Patients</td>
              <td>{{diabeticPatients}}</td>
            </tr>
            <tr>
              <td>Screening &amp; Prevention</td>
              <td>{{screeningAndPrevention}}</td>
            </tr>
            <tr>
              <td>New Ulcerations</td>
              <td>{{newUlcerations}}</td>
            </tr>
            <tr>
              <td>Wound Care</td>
              <td>{{woundCare}}</td>
            </tr>
            <tr>
              <td>Total Visits</td>
              <td>{{totalVisits}}</td>
            </tr>
          </tbody>
        </table>

        <table class="table table-striped">
          <thead>
            <tr>
              <th colspan="3">Breakdown by Risk Group</th>
            </tr>
            <tr>
              <td>Risk</td>
              <td>Patients</td>
              <td>Visits</td>
            </tr>
          </thead>
          <tbody>
            <template repeat="{{group in groups}}">
              <tr>
                <td>{{group.number}}</td>
                <td>{{group.patients}}</td>
                <td>{{group.visits}}<td>
              </t>
            </template>
          </tbody>
        </table>
        <paper-button id="reset">Reset</paper-button>
      </section>
    </core-animated-pages>
  </template>
  <script>
    (function () {
      Polymer('diabetic-calculator', {
        ready: function () {
          var calc = this;
          calc.percentage = 7;
          calc.population = 100;

          calc.selectPercentage();
          // calc.$.population.focus();
          calc.$.selectPercentage.addEventListener('click', function() {
            calc.percentage = calc.$.slider.value;
            calc.population = calc.$.population.value;

            calc.showStats();
          });
          calc.$.reset.addEventListener('click', function() {
            calc.selectPercentage();
          });
        },
        selectPercentage: function() {
          this.step = 0;
        },
        showStats: function() {
          var calc = this;
          calc.step = 1;

          var pop = calc.population * calc.percentage / 10;
          calc.groups = [
            {
              number: 0,
              patients: pop * .4230,
              visits: 100
            },
            {
              number: 1,
              patients: pop * .1510,
              visits: 100
            },
            {
              number: 2,
              patients: pop * .2800,
              visits: 100
            },
            {
              number: 3,
              patients: pop * .1460,
              visits: 100
            }
          ]
          // TODO: Calculate
          calc.diabeticPatients = 1;
          calc.screeningAndPrevention = 2;
          calc.newUlcerations = 3;
          calc.woundCare = 4;
          calc.totalVisits = 5;
        }
      });
    })();
  </script>
</polymer-element>
